@model IEnumerable<MVCProject.Models.AspNetUser>

@{
    ViewBag.Title = "Danh sách người dùng";
    Layout = "~/Views/Shared/_Layout.cshtml";
    Dictionary<string,string> types = (Dictionary<string,string>)ViewBag.TypeList;
    Dictionary<int,string> location = (Dictionary<int,string>)ViewBag.LocationList;
    List<string> roles = (List<string>)ViewData["AccessList"];
    string msg = Request.QueryString["msg"];
    
}
<section class="content-header">
    <h2>
        @ViewBag.Title
    </h2>
    <span style="color:red;font-weight:bold;">
        @if (msg == null) { msg = ""; }
        @msg
        </span>
    <div class="arrange-button">
        @if (roles.Contains("12"))
        {
            <a href="~/Account/Register" class="btn btn-info" id="modaltrigger" rel="leanModal">Thêm mới</a>
        }
    </div>
</section>
<section class="content">
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr style="background-color: #3c8dbc; color:#fff">
                    <th>
                        Tên đăng nhập
                    </th>
                    <th>
                        Tên cá nhân/đại lý
                    </th>
                    <th>#</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model) {
                    string actname = "Phân quyền", action = "Roles";
                    string en = MVCProject.Common.Security.EncryptString("User:" + item.UserName + "~FrontendUser", 
                        false, MVCProject.Common.EncryptType.TripleDES);
                    if (types.Keys.Contains(en))
                    {
                        actname = "Thông tin đại lý";
                        action = "Agent";
                    }
                    else
                    {
                        string end = MVCProject.Common.Security.EncryptString("User:" + item.UserName + "~DeliveryMan",
                            false, MVCProject.Common.EncryptType.TripleDES);
                        if (types.Keys.Contains(end))
                        {
                            en = end;
                            actname = "Nhân viên giao hàng";
                            action = null;
                        }
                    }
                    string name = "";
                    if (!types.Keys.Contains(en))
                    {
                        name = item.UserName;
                    }
                    else
                    {
                        name = types[en];
                    }
                    
                    if (action == null || (action == "Roles" && roles.Contains("14")) || (action == "Agent" && roles.Contains("13")))
                    { 
                        <tr>
                            <th scope="row" style="text-align:left">
                                @Html.DisplayFor(modelItem => item.UserName)
                            </th>
                            <td>
                  
                                @name
                            </td>
                            <td>
                                @if (action != null) { 
                                    @Html.ActionLink(actname, action, new { id = item.UserName })
                                }
                                else
                                {
                                    @actname
                                }
                            </td>
                        </tr>
                    }
                    
                }
            </tbody>
        </table>
    </div>
</section>